{% extends "skosapp/header.html" %}
{% load crispy_forms_tags %}
{% load static %}


{% block content %}
    <div style="padding:40px;margin:40px;border:1px solid #ccc">
    <link rel="stylesheet" type="text/css" href="{% static 'skosapp/css/highlight-style.css' %}">
        <div class="row">
            <div class="col-md-10">
                <h1 id="header1">Upload text to analyze</h1>
                <form action="#" method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <p id="result_p">{{ text }}</p>
                    </div>
                </form>
                <br>
                <table class="table" id="myTable">
                    <thead>
                    <tr>
                        <th>Term</th>
                        <th>Occurrences</th>
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>

{#        {% for r in rdf %}#}
{#            {{forloop.counter}}.<a href="{{ r.rdf_file.url }}">{{ r.rdf_file.name }}</a>#}
{#            ({{r.upload_date}})<hr />#}
{#        {% endfor %}#}
                <button type="button" class="btn btn-info">Export</button>
            </div>
        </div>

    </div>
    <script type="application/javascript" src="{% static 'skosapp/js/jquery.mark.min.js' %}"></script>
    <script>

            $(document).ready(function () {

                $('#result_p').mark({{ json_thesaurus|safe }}, {
                    "accuracy":"exactly",
                    "className":"mark",
                    "separateWordSearch" : false
                });
            });
    </script>
    <script type="application/javascript">

        String.prototype.count = function(lit, cis) {
            var m = this.toString().match(new RegExp(lit, ((cis) ? "gi" : "g")));
            return (m != null) ? m.length : 0;
        }

    var arrayLength = {{ json_thesaurus|safe }}.length;

        //TEST IT WITH THE STRING 'KJ METHOD'
    for(var i = 0; i < arrayLength; i++)
    {
        var amount_of_occurrences = "{{ text }}".count({{ json_thesaurus|safe }}[i], true);
        if(amount_of_occurrences != 0)
        {
            var table = document.getElementById('myTable').getElementsByTagName('tbody')[0];
            var newRow = table.insertRow(0);
            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            cell1.innerHTML = {{ json_thesaurus|safe }}[i];
            cell2.innerHTML = amount_of_occurrences;
        }
    }

    </script>

{% endblock %}